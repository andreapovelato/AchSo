<!DOCTYPE html><html><head><meta charset="utf-8"><style>html { font-size: 100%; overflow-y: scroll; -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }

body{
  color:#444;
  font-family:Georgia, Palatino, 'Palatino Linotype', Times, 'Times New Roman',
              "Hiragino Sans GB", "STXihei", "微软雅黑", serif;
  font-size:12px;
  line-height:1.5em;
  background:#fefefe;
  width: 45em;
  margin: 10px auto;
  padding: 1em;
  outline: 1300px solid #FAFAFA;
}

a{ color: #0645ad; text-decoration:none;}
a:visited{ color: #0b0080; }
a:hover{ color: #06e; }
a:active{ color:#faa700; }
a:focus{ outline: thin dotted; }
a:hover, a:active{ outline: 0; }

span.backtick {
  border:1px solid #EAEAEA;
  border-radius:3px;
  background:#F8F8F8;
  padding:0 3px 0 3px;
}

::-moz-selection{background:rgba(255,255,0,0.3);color:#000}
::selection{background:rgba(255,255,0,0.3);color:#000}

a::-moz-selection{background:rgba(255,255,0,0.3);color:#0645ad}
a::selection{background:rgba(255,255,0,0.3);color:#0645ad}

p{
margin:1em 0;
}

img{
max-width:100%;
}

h1,h2,h3,h4,h5,h6{
font-weight:normal;
color:#111;
line-height:1em;
}
h4,h5,h6{ font-weight: bold; }
h1{ font-size:2.5em; }
h2{ font-size:2em; border-bottom:1px solid silver; padding-bottom: 5px; }
h3{ font-size:1.5em; }
h4{ font-size:1.2em; }
h5{ font-size:1em; }
h6{ font-size:0.9em; }

blockquote{
color:#666666;
margin:0;
padding-left: 3em;
border-left: 0.5em #EEE solid;
}
hr { display: block; height: 2px; border: 0; border-top: 1px solid #aaa;border-bottom: 1px solid #eee; margin: 1em 0; padding: 0; }


pre , code, kbd, samp { 
  color: #000; 
  font-family: monospace; 
  font-size: 0.88em; 
  border-radius:3px;
  background-color: #F8F8F8;
  border: 1px solid #CCC; 
}
pre { white-space: pre; white-space: pre-wrap; word-wrap: break-word; padding: 5px 12px;}
pre code { border: 0px !important; padding: 0;}
code { padding: 0 3px 0 3px; }

b, strong { font-weight: bold; }

dfn { font-style: italic; }

ins { background: #ff9; color: #000; text-decoration: none; }

mark { background: #ff0; color: #000; font-style: italic; font-weight: bold; }

sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }

ul, ol { margin: 1em 0; padding: 0 0 0 2em; }
li p:last-child { margin:0 }
dd { margin: 0 0 0 2em; }

img { border: 0; -ms-interpolation-mode: bicubic; vertical-align: middle; }

table { border-collapse: collapse; border-spacing: 0; }
td { vertical-align: top; }

@media only screen and (min-width: 480px) {
body{font-size:14px;}
}

@media only screen and (min-width: 768px) {
body{font-size:16px;}
}

@media print {
  * { background: transparent !important; color: black !important; filter:none !important; -ms-filter: none !important; }
  body{font-size:12pt; max-width:100%; outline:none;}
  a, a:visited { text-decoration: underline; }
  hr { height: 1px; border:0; border-bottom:1px solid black; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; padding-right: 1em; page-break-inside: avoid; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page :left { margin: 15mm 20mm 15mm 10mm; }
  @page :right { margin: 15mm 10mm 15mm 20mm; }
  p, h2, h3 { orphans: 3; widows: 3; }
  h2, h3 { page-break-after: avoid; }
}
</style><title>achso_server_connection</title></head><body><h1 id="ach-so-server-connection">Ach so! server connection</h1>
<p>This is an API description of connections from Ach so! -Android client to servers. This document has two purposes: to collect Ach so! developers' suggestions what server APIs should provide and for server backend developers to document what exactly their API is providing and how to call its features. </p>
<p>If you have a server API that is doing something close to what is described here, please modify the description here to describe your API. If you have something that you are going to implement, but is not implemented yet, mention it here.</p>
<h2 id="uploading-and-updating">Uploading and updating</h2>
<p>I have assumed 2 services to handle Ach so! videos. One is VideoStorage service (e.g. ClViTra2.0) and the other is the service that understands Ach so! metadata, AchSoService.</p>
<p>The workflow for uploading is following:</p>
<ul>
<li>Prepare necessary authentication means for both services, AchSoService and VideoStorage.</li>
<li>Ask AchSoService for unique id that can be used to recognize both the video file in VideoStorage and metadata in AchSoService  (<code>get_unique_id</code>).</li>
<li>Send video metadata (including <code>unique_id</code>) to AchSoService, with <code>video_uri</code> and <code>thumbnail_uri</code> empty.(<code>upload_video_metadata</code>)</li>
<li>If Success: Send video file to video upload service (use key as filename). (<code>upload_video</code>)</li>
<li>If Success: Start polling upload service (<code>get_processing_state</code>) with key<ul>
<li>write to AchSo's SharedPreferences that polling of video $key is active. – If app is shut down and resumed, we know to resume polling.</li>
</ul>
</li>
<li>When poll replies with <code>'state' == 'finished'</code>, update video metadata (<code>upload_video_metadata</code>) with <code>video_uri</code> and <code>thumbnail_uri</code>.<ul>
<li>remove polling instruction from AchSo prefs. OR</li>
<li>When replies <code>'state' == 'encoding error'</code> or <code>'not found'</code>, stop polling &amp; remove polling instruction from AchSo prefs. Alert user.</li>
</ul>
</li>
</ul>
<p>The workflow for modifying video metadata is following:</p>
<ul>
<li>Prepare necessary authentication means for both services, AchSoService and VideoStorage.</li>
<li>If online: call upload_video_metadata with video key and changed fields (JSON object), if this returns <code>Ok</code>, we are done.</li>
<li>If offline:<ul>
<li>add changes (as a JSON string) to pending changes in AchSo prefs. </li>
<li>When back online, send changes with <code>upload_video_metadata</code>. (Ach so! needs to do some cleaning to remove redundant changes before sending.)</li>
<li>Note that this is vulnerable to conflicts, or older changes rewriting newer changes. We can see if it is worth working around with timestamps for modifications or such.) </li>
</ul>
</li>
</ul>
<p>The workflow for modifying existing annotation is following:</p>
<ul>
<li>Prepare necessary authentication means for both services, AchSoService and VideoStorage.</li>
<li>If online:<ul>
<li>call ´update_annotation´ with annotation key and changed fields.</li>
<li>If Success: done</li>
</ul>
</li>
<li>If offline:<ul>
<li>add changes (JSON string) to pending changes in AchSo prefs.</li>
<li>When back online, send changes with <code>update_annotation</code>. (Ach so! needs to do some cleaning to remove redundant changes before sending.)</li>
</ul>
</li>
</ul>
<p>The workflow for adding annotation (for uploaded video) is following:
    - (prepare authentication means for ach so data service)
    - If online:
        - call upload_annotation with annotation data.
        - If Success: done
    - If offline:
        - add annotation (json string) to pending changes in AchSo prefs. When back online, send changes with upload_annotation.</p>
<p>Before uploading we create random uid in Ach so!, which will be used as a key in database and as an unique part of URI. </p>
<h2 id="calls-to-videostorage">Calls to VideoStorage</h2>
<h3 id="upload-video">upload_video</h3>
<p>This is used to send video for encoding/conversion </p>
<p><em>Request:</em> POST</p>
<p><em>URL:</em> </p>
<pre><code>http://$video_storage_api/upload
eg. 
http://$server/ClViTra_2.0/rest/upload
</code></pre>
<p><em>What is sent:</em> </p>
<p>"File" as "multipart/form-data". File has filename, which is form of <code>$key.$suffix</code>, where <code>$suffix</code> is mp4,avi,mpg... This filename (without suffix) will be used when querying the state of the processing, so remember it.</p>
<p><em>Headers:</em> authentication token?</p>
<p><em>What is received:</em> </p>
<pre><code>200: Success
404: URL not found
401: Unauthorized
500: Server Errors
</code></pre>
<p><em>Example:</em></p>
<pre><code class="java">HttpPost httppost = new HttpPost(&quot;http://merian.informatik.rwth-aachen.de:5080/ClViTra_2.0/rest/upload&quot;);
httppost.setHeader(&quot;X-auth-token&quot;, &quot;04ef789a010c6f252a9f572347cac345&quot;);
MultipartEntityBuilder multipart_entity = MultipartEntityBuilder.create();
multipart_entity.addPart(&quot;File&quot;, new FileBody(video_file));
httppost.setEntity(multipart_entity);
...
httpclient.execute(httppost);
...
</code></pre>

<h3 id="get-processing-state">get_processing_state</h3>
<p>This is used to check if the video $key has finished its encoding and to receive the uri to use when playing it.  </p>
<p><em>URL:</em> </p>
<pre><code>http://$video_storage_api/videoDetail/$user/$videoId

"user": Sender of the video,
"videoId":String, which is the unique filename that was sent when uploading video, .
</code></pre>
<p><em>What is sent:</em> Arguments are included in the path</p>
<p><em>What is received:</em></p>
<pre><code>200: (Success) "{'Video_Name':'Name', 'Video_URL':$video_uri, 'Thumbnail_URL':$thumbnail_uri,'Status':'Transcoded'}"
-OR- 
"{'state':'processing', 'thumbnail':$thumbnail_uri'}
-OR- 
"{'status':'Not Found'}

404: URL not found.
401: Unauthorized.
500: Server Error.
</code></pre>
<p><em>Example:</em></p>
<pre><code>http://merian.informatik.rwth-aachen.de:5080/ClViTra_2.0/rest/videoDetail/testUser/ea901369-3ae0-42c6-aece-41151e474472

&gt;"{'Video_Name':'Sample.mp4', 'Video_URL':'http://tosini.informatik.rwth-aachen.de:8134/videos/ea901369-3ae0-42c6-aece-41151e474472.mp4', 'Thumbnail_URL':'http://tosini.informatik.rwth-aachen.de:8134/thumbnails/ea901369-3ae0-42c6-aece-41151e474472.jpg','Status':'Transcoded'}"


http://merian.informatik.rwth-aachen.de:5080/ClViTra_2.0/rest/videoDetail/testUser/foobar

&gt;"{'Status':'Not Found'}"
</code></pre>
<h2 id="calls-to-achsoservice">Calls to AchSoService</h2>
<h3 id="get-unique-id">get_unique_id</h3>
<p>Returns a new unique id. Semantic video can safely use this as an identifier and this identifier is used as a key to retrieve video metadata and annotations, and to retrieve the state of the video encoding process. </p>
<p><em>Request:</em> GET</p>
<p><em>URL:</em></p>
<pre><code>http://$ach_so_api/get_unique_id
</code></pre>
<p><em>What is sent:</em> nothing</p>
<p><em>Headers:</em> authentication token?</p>
<p><em>Returns:</em></p>
<pre><code>200: unique id string, e.g: "e0c3da80-e4cc-11e3-890e-5f6eb36c1ac9"
</code></pre>
<h3 id="upload-video-metadata">upload_video_metadata</h3>
<p>This is used to upload annotations and metadata for video. This is done before sending the actual video file, but the video uri and thumb uri have placeholders instead of actual values. When upload_video is completed, Ach so! polls server with get_processing_state until it receives 'finished' state as response, and then does update_metadata with new uri values.</p>
<p>Ach saves to its local preferences when unfinished video processing polling is activated, so that it can continue and finalize the video metadata next time Ach so is launched, in case that the Ach so is shut down while the processing in server side is still going on.   </p>
<p>Communities is a list of community uids/keys. Usually adding and removing video to/from community is done through community api methods, but it is here for convenience, so that video can be created and shared with one call. </p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em></p>
<pre><code>http://$ach_so_api/upload_video_metadata
</code></pre>
<p><em>What is sent:</em> "data" as UTF-8 StringEntity. 
"data" is json-representation of SemanticVideo:</p>
<pre><code>SemanticVideo = json_object({
    title: String,
    creator: String,
    qr_code: String,
    created_at: Number,
    video_uri: String,
    genre: String,
    key: String,
    latitude: Number,
    longitude: Number,
    accuracy: Number,
    duration: Number,
    thumb_uri: String,
    communities: String[],
    annotations: Annotation[]
    })
where each Annotation = {
    creator: String,
    start_time: Number,
    position_x: Number,
    position_y: Number,
    text: String,
    scale: Number,
    key: String
}
</code></pre>
<p><em>Headers:</em></p>
<pre><code>authentication token? 
"Content-type":"application/json" 
"Accept":"application/json"
</code></pre>
<p>In server side annotations should be saved as individual objects that have a reference to semantic video they belong to. It is easier to avoid conflicts when updating annotations. Annotation keys are created by server.</p>
<p><em>What is received:</em></p>
<pre><code>200: Success.
404: URL not found.
401: Unauthorized.
500: Server Error.
</code></pre>
<p><em>Example:</em></p>
<pre><code>json = "{
    'title': '1st video of Friday',
    'creator': 'Jukka',
    'qr_code': 'http://learning-layers.eu/',
    'created_at': 1399550703652,
    'video_uri': '',
    'genre': 'Good work',
    'key': 'ea901369-3ae0-42c6-aece-41151e474472',
    'latitude': null,
    'longitude': null,
    'accuracy': null,
    'duration': 324993,
    'thumb_uri': '',
    'communities': ['public'],
    'annotations': [
        {
        'creator': 'Jukka',
        'start_time': 12003,
        'position_x': 0.33,
        'position_y': 0.7,
        'scale': 1.2,
        'text': 'I made a scratch here.',
        'key': 'A2f-ea901369-3ae0-42c6-aece-41151e474472'
        },
        {
        'creator': 'Jukka',
        'start_time': 22003,
        'position_x': 0.63,
        'position_y': 0.12,
        'scale': 1.0,
        'text': 'Good seam.',
        'key': 'A36-ea901369-3ae0-42c6-aece-41151e474472'
        }
    ]
}";
HttpPost httppost = new HttpPost("http://merian.informatik.rwth-aachen.de:5080/AchSoServer/rest/upload_video_metadata");        
httppost.setHeader("X-auth-token", "04ef789a010c6f252a9f572347cac345");
httppost.setHeader("Content-type", "application/json");
httppost.setHeader("Accept":"application/json");
StringEntity se = new StringEntity(json, "UTF-8");
httppost.setEntity(se);
...
httpclient.execute(httppost);
...
</code></pre>
<h3 id="update-video-metadata">update_video_metadata</h3>
<p>Update some of the fields of the video -- those that are included in the sent json object (excluding 'key', it cannot be changed, it is used to find what video to change.). It is otherwise similar to upload_metadata. Annotations are not updated through this, they use 
update_annotation or upload_annotation, with a video_key to link them to this video.</p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/update_video_metadata
</code></pre>
<p><em>What is sent</em>: field "data" where content is UTF-8 encoded JSON. 
    data is partial json-representation of SemanticVideo:</p>
<pre><code>{
    key: String, **rest are optional: **
    title: String,
    creator: String,
    qr_code: String,
    created_at: Number,
    video_uri: String,
    genre: String,
    key: String,
    latitude: Number,
    longitude: Number,
    accuracy: Number,
    duration: Number,
    thumb_uri: String
}
</code></pre>
<p><em>Headers</em>: </p>
<pre><code>authentication token?
"Content-type":"application/json" 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>200: Success.
404: URL not found.
401: Unauthorized.
500: Server Error.
</code></pre>
<p><em>example:</em></p>
<pre><code class="java">    json = &quot;{
        'key': 'ea901369-3ae0-42c6-aece-41151e474472',
        'video_uri': 'http://tosini.informatik.rwth-aachen.de:8134/videos/ea901369-3ae0-42c6-aece-41151e474472.mp4',
        'thumb_uri': 'http://tosini.informatik.rwth-aachen.de:8134/thumbnails/ea901369-3ae0-42c6-aece-41151e474472.jpg',
    }&quot;;
    HttpPost httppost = new HttpPost(&quot;http://merian.informatik.rwth-aachen.de:5080/AchSoServer/rest/upload_video_metadata&quot;);        
    httppost.setHeader(&quot;X-auth-token&quot;, &quot;04ef789a010c6f252a9f572347cac345&quot;);
    httppost.setHeader(&quot;Content-type&quot;, &quot;application/json&quot;);
    httppost.setHeader(&quot;Accept&quot;:&quot;application/json&quot;);
    StringEntity se = new StringEntity(json, &quot;UTF-8&quot;);
    httppost.setEntity(se);
    ...
    httpclient.execute(httppost);
    ...
</code></pre>

<h3 id="upload-annotation">upload_annotation</h3>
<p>This is used to upload new annotation for existing video. </p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/upload_annotation
</code></pre>
<p><em>What is sent:</em> "data" as UTF-8 StringEntity. 
data is a json-representation of Annotation:</p>
<pre><code>Annotation = {
    creator: String,
    start_time: Number,
    position_x: Number,
    position_y: Number,
    text: String,
    scale: Number,
    key: String,
    video_key: String,
}
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>"X-auth-token":$token 
"Content-type":"application/json" 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em> </p>
<pre><code>200: Success.
404: URL not found.
401: Unauthorized.
500: Server Error.
</code></pre>
<p><em>Example:</em></p>
<pre><code class="java">    json = &quot;{
            'creator': 'Jukka',
            'start_time': 12003,
            'position_x': 0.33,
            'position_y': 0.7,
            'scale': 1.2,
            'text': 'I made a scratch here.',
            'key': 'A2f-ea901369-3ae0-42c6-aece-41151e474472',
            'video_key': 'ea901369-3ae0-42c6-aece-41151e474472'
    }&quot;;
    HttpPost httppost = new HttpPost(&quot;http://merian.informatik.rwth-aachen.de:5080/AchSoServer/rest/upload_annotation&quot;);        
    httppost.setHeader(&quot;X-auth-token&quot;, &quot;04ef789a010c6f252a9f572347cac345&quot;);
    httppost.setHeader(&quot;Content-type&quot;, &quot;application/json&quot;);
    httppost.setHeader(&quot;Accept&quot;:&quot;application/json&quot;);
    StringEntity se = new StringEntity(json, &quot;UTF-8&quot;);
    httppost.setEntity(se);
    ...
    httpclient.execute(httppost);
    ...
</code></pre>

<h3 id="update-annotation">update_annotation</h3>
<p>This is used to update attributes of existing annotation. Attributes are given as JSON object, and it needs only to include those fields that have changed.</p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/update_annotation
</code></pre>
<p><em>What is sent:</em> "data" as UTF-8 StringEntity. 
    "data" is a json-representation of Annotation:</p>
<pre><code>Annotation = {
    key: String, *** Rest are optional: ***
    creator: String,
    start_time: Number,
    position_x: Number,
    position_y: Number,
    text: String,
    scale: Number,
}
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>"X-auth-token":$token 
"Content-type":"application/json" 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>200: Success.
404: URL not found.
401: Unauthorized.
500: Server Error.
</code></pre>
<p><em>Example:</em></p>
<p>```java    json = "{
            'key': 'A2f-ea901369-3ae0-42c6-aece-41151e474472',
            'position_x': 0.6,
            'position_y': 0.2
    }";</p>
<pre><code>HttpPost httppost = new HttpPost("http://merian.informatik.rwth-aachen.de:5080/AchSoServer/rest/upload_annotation");        
httppost.setHeader("X-auth-token", "04ef789a010c6f252a9f572347cac345");
httppost.setHeader("Content-type", "application/json");
httppost.setHeader("Accept":"application/json");
StringEntity se = new StringEntity(json, "UTF-8");
httppost.setEntity(se);
...
httpclient.execute(httppost);
...
</code></pre>
<p>```</p>
<h2 id="annotation-listings">Annotation listings</h2>
<h3 id="get-annotations">get_annotations</h3>
<p>List of annotations for given video_key </p>
<p><em>Request:</em> GET</p>
<p><em>URL:</em> </p>
<pre><code>http://???/get_annotations
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>video_key:String
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>"X-auth-token":$token
</code></pre>
<p><em>What is received:</em>
    JSON list of annotation objects, not ordered in any meaningful way</p>
<h2 id="video-listings">Video listings</h2>
<h3 id="get-videos">get_videos</h3>
<p>General interface for receiving list of videos that fill given conditions. 
For searches, searches should also look into annotations and return videos that include matching annotations.
Even if community is empty, results should be filtered by those communities that the user can see.</p>
<p><em>Request:</em> GET</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/get_videos
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>keywords may include subset of following:
search:"searchstring":String,
by_user:"username":String,
community: "community_key":String,
genre: "genre_id":String,
batch_size: 30(default):Number,
result_page: 1(default):Number,
sort_by:"date"(default)|"most_views", 
sort_order:(default)descending|ascending
name:"community_name":String, 
listed:true|false|1|0:Boolean, 
open:true|false|1|0:Boolean,
moderators:[user_id,]&lt;String&gt;
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>"X-auth-token":$token 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em>
    unique id of community, or empty if it already exists</p>
<h2 id="communities">Communities</h2>
<p>These are the groups/channels that are used to deduce video visibility and editing rights.</p>
<h3 id="add-community">add_community</h3>
<p>Create a community that has access to videos </p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/add_community
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>JSON object, where:  
name:"name":String, 
listed:true|false|1|0:Boolean, 
open:true|false|1|0:Boolean,
moderators:[user_id,]:&lt;String&gt;
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>"X-auth-token":$token 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em>
    unique id of community, or empty if it already exists</p>
<h3 id="edit-community">edit_community</h3>
<p>Change community settings, only by moderator </p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/edit_community
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>JSON object, where key is mandatory and others are optional:
key:"stringid":String,
name:"community_name":String, 
listed:true|false|1|0:Boolean, 
open:true|false|1|0:Boolean,
moderators:[user_id,]&lt;String&gt;
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em>
    unique id of community, or empty if it already exists</p>
<h3 id="join-community">join_community</h3>
<p>Join user xx to a community. If closed community, this is done by authenticated user who is a moderator. Username for authenticated user is retrievable from X-auth-token?</p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/join_community
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>name:"community_uid":String, 
user_id:"xx":String
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>"success" or "not allowed"
</code></pre>
<h3 id="leave-community">leave_community</h3>
<p>Leave from a community. User xx is removed from community. There should be checks that the X-auth-token points to same user xx or to a moderator?</p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/leave_community
</code></pre>
<p><em>What is sent:</em> </p>
<pre><code>name:"community_uid":String, 
user_id:"xx":String
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>"success" or "not allowed"
</code></pre>
<h3 id="get-communities">get_communities</h3>
<p>Return a list of listable communities (no arguments), or list of provided user_id:s communities. List is a json object </p>
<p><em>Request:</em> GET</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/get_communities
</code></pre>
<p><em>What is sent:</em> </p>
<pre><code>user_id:"xx":String (optional)
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>[{name:String, key:String, open:Boolean, listed:Boolean, is_member:Boolean, is_moderator},... ]
</code></pre>
<p>notice that if user_id is not given, is_member and is_moderator can default to false.</p>
<h3 id="add-video-to-community">add_video_to_community</h3>
<p>Add a video to belong for a community. It is then visible for community members Requires video_key and community_id as arguments. </p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/add_video_to_community
</code></pre>
<p><em>What is sent:</em> </p>
<pre><code>name:"community_id":String, 
video_key:"xx":String
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>"success" or "not allowed"
</code></pre>
<h3 id="remove-video-from-community">remove_video_from_community</h3>
<p>Video is no longer listed as belonging to a community. Requires video_key and community_id as arguments. </p>
<p><em>Request:</em> POST.</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/remove_video_from_community
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>name:"community_id":String, 
video_key:"xx":String
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em></p>
<pre><code>"success" or "not allowed"
</code></pre>
<h3 id="get-videos-in-community">get_videos_in_community</h3>
<p>Return metadata of videos in community. User must be a member in community to get listing  </p>
<p><em>Request:</em> GET</p>
<p><em>URL:</em> </p>
<pre><code>http://$ach_so_api/get_videos_in_community
</code></pre>
<p><em>What is sent:</em></p>
<pre><code>community_id:"xx":String,
</code></pre>
<p><em>Headers:</em> </p>
<pre><code>authentication token? 
"Accept":"application/json"
</code></pre>
<p><em>What is received:</em>
    JSON list of semantic video objects</p></body></html>